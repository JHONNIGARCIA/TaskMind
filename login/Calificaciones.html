<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Calificaciones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #6b73ff 0%, #000dff 100%);
        }
        .grade-input:invalid {
            border-color: #ef4444;
        }
        .grade-input:valid {
            border-color: #10b981;
        }
        .floating-label {
            transition: all 0.3s ease;
        }
        input:focus + .floating-label,
        input:not(:placeholder-shown) + .floating-label {
            transform: translateY(-22px);
            font-size: 0.75rem;
            color: #3b82f6;
        }
    </style>
</head>
<body class="min-h-screen flex">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-lg hidden md:flex flex-col">
        <div class="p-4 border-b border-gray-200">
            <h1 class="text-xl font-bold text-indigo-600">Agenda Académica</h1>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <nav>
                <ul class="space-y-2">
                    <li>
                        <a href="portal.html" class="flex items-center p-2 text-indigo-600 rounded-lg bg-indigo-50 font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
                            </svg>
                            Tareas
                        </a>
                    </li>
                    <li>
                        <a href="Calificaciones.html" class="flex items-center p-2 text-gray-600 rounded-lg hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
                            </svg>
                            Mis Calificaciones
                        </a>
                    </li>
                    <li>
                        <a href="calendario.html" class="flex items-center p-2 text-gray-600 rounded-lg hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                            </svg>
                            Calendario
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="p-4 border-t border-gray-200">
            <div class="flex items-center">
                <div class="relative">
                    <img id="sidebar-foto-perfil" src="" alt="Foto de perfil" class="w-10 h-10 rounded-full object-cover">
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></span>
                </div>
                <div class="ml-3">
                    <p class="font-medium text-sm" id="sidebar-nombre">Perfil</p>
                    <p class="text-xs text-gray-500">Estudiante</p>
                </div>
            </div>
        </div>
    </div>
    <div class="container mx-auto px-4 py-8">
        <div class="gradient-bg text-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold mb-2">Registro de Calificaciones</h1>
            <p class="opacity-90">Sistema interactivo para registrar y administrar calificaciones académicas</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Formulario de registro -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Nueva Calificación</h2>
                
                <form id="gradeForm" class="space-y-6">
                    <div class="relative">
                        <select id="subject" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" disabled selected>Seleccione una materia</option>
                            <option value="Matemáticas">Matemáticas</option>
                            <option value="Lengua Española">Lengua Española</option>
                            <option value="Ciencias">Ciencias</option>
                            <option value="Historia">Historia</option>
                            <option value="Educación Física">Educación Física</option>
                            <option value="Arte">Arte</option>
                            <option value="Música">Música</option>
                            <option value="Otro">Otra materia</option>
                        </select>
                    </div>

                    <div class="relative">
                        <input 
                            id="grade" 
                            type="number" 
                            min="0" 
                            max="10" 
                            step="0.1" 
                            placeholder=" "
                            class="grade-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        >
                        <label for="grade" class="floating-label absolute left-4 top-2 text-gray-500 pointer-events-none">Calificación (0-10)</label>
                    </div>

                    <div class="relative">
                        <input 
                            id="date" 
                            type="date" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        >
                        <label for="date" class="absolute left-4 top-2 text-gray-500 pointer-events-none">Fecha</label>
                    </div>

                    <div class="relative">
                        <textarea 
                            id="notes" 
                            rows="3"
                            placeholder="Observaciones (opcional)"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        ></textarea>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            Todos los campos son obligatorios, excepto observaciones
                        </div>
                        <button 
                            type="submit"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition"
                        >
                            Registrar Calificación
                        </button>
                    </div>
                </form>
            </div>

            <!-- Estadísticas y resultados -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Resumen Académico</h2>
                    <button 
                        id="clearAllBtn"
                        class="px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50 focus:outline-none"
                    >
                        Limpiar Todo
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm text-blue-800 mb-1">Total Registros</div>
                        <div id="totalGrades" class="text-2xl font-bold text-blue-900">0</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm text-green-800 mb-1">Promedio General</div>
                        <div id="averageGrade" class="text-2xl font-bold text-green-900">0.00</div>
                    </div>
                </div>

                <!-- Tabla de calificaciones -->
                <div class="overflow-x-auto">
                    <table id="gradesTable" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materia</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Calificación</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="gradesTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Las filas se agregarán dinámicamente -->
                        </tbody>
                    </table>
                </div>

                <!-- Gráfico de desempeño -->
                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-800 mb-3">Desempeño por Materia</h3>
                    <div id="performanceChart" class="h-40 bg-gray-50 rounded-lg flex items-center justify-center">
                        <p class="text-gray-500 text-sm">Los gráficos se mostrarán cuando haya datos</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">Editar Calificación</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editId">
                
                <div>
                    <label for="editSubject" class="block text-sm font-medium text-gray-700 mb-1">Materia</label>
                    <select id="editSubject" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Matemáticas">Matemáticas</option>
                        <option value="Lengua Española">Lengua Española</option>
                        <option value="Ciencias">Ciencias</option>
                        <option value="Historia">Historia</option>
                        <option value="Educación Física">Educación Física</option>
                        <option value="Arte">Arte</option>
                        <option value="Música">Música</option>
                        <option value="Otro">Otra materia</option>
                    </select>
                </div>
                
                <div>
                    <label for="editGrade" class="block text-sm font-medium text-gray-700 mb-1">Calificación</label>
                    <input id="editGrade" type="number" min="0" max="10" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                    <label for="editDate" class="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                    <input id="editDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                    <label for="editNotes" class="block text-sm font-medium text-gray-700 mb-1">Observaciones</label>
                    <textarea id="editNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancelEditBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Datos del registro
        let grades = JSON.parse(localStorage.getItem('grades')) || [];
        
        // Elementos del DOM
        const gradeForm = document.getElementById('gradeForm');
        const subjectInput = document.getElementById('subject');
        const gradeInput = document.getElementById('grade');
        const dateInput = document.getElementById('date');
        const notesInput = document.getElementById('notes');
        const gradesTableBody = document.getElementById('gradesTableBody');
        const totalGradesElement = document.getElementById('totalGrades');
        const averageGradeElement = document.getElementById('averageGrade');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const editSubject = document.getElementById('editSubject');
        const editGrade = document.getElementById('editGrade');
        const editDate = document.getElementById('editDate');
        const editNotes = document.getElementById('editNotes');
        const editId = document.getElementById('editId');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        
        // Inicializar la aplicación
        function init() {
            renderGrades();
            updateStats();
            
            // Configurar la fecha actual como predeterminada
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;
        }
        
        // Renderizar las calificaciones en la tabla
        function renderGrades() {
            gradesTableBody.innerHTML = '';
            
            if (grades.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="4" class="px-4 py-4 text-center text-sm text-gray-500">
                        No hay calificaciones registradas aún
                    </td>
                `;
                gradesTableBody.appendChild(emptyRow);
                return;
            }
            
            grades.forEach((grade, index) => {
                const row = document.createElement('tr');
                row.dataset.id = grade.id;
                row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                
                // Determinar el color según la calificación
                let colorClass = 'text-gray-800';
                if (grade.grade < 5) {
                    colorClass = 'text-red-600 font-medium';
                } else if (grade.grade >= 8) {
                    colorClass = 'text-green-600 font-medium';
                }
                
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">${grade.subject}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm ${colorClass}">${grade.grade.toFixed(1)}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${grade.date}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm">
                        <button class="edit-btn mr-2 text-blue-600 hover:text-blue-800 focus:outline-none">
                            Editar
                        </button>
                        <button class="delete-btn text-red-600 hover:text-red-800 focus:outline-none">
                            Eliminar
                        </button>
                    </td>
                `;
                
                gradesTableBody.appendChild(row);
            });
            
            // Agregar event listeners a los botones
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', handleEdit);
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', handleDelete);
            });
        }
        
        // Actualizar estadísticas
        function updateStats() {
            totalGradesElement.textContent = grades.length;
            
            if (grades.length > 0) {
                const sum = grades.reduce((acc, grade) => acc + grade.grade, 0);
                const average = sum / grades.length;
                averageGradeElement.textContent = average.toFixed(2);
                
                // Actualizar gráfico de desempeño
                updatePerformanceChart();
            } else {
                averageGradeElement.textContent = '0.00';
                document.getElementById('performanceChart').innerHTML = `
                    <p class="text-gray-500 text-sm">Los gráficos se mostrarán cuando haya datos</p>
                `;
            }
        }
        
        // Actualizar gráfico de desempeño (simple)
        function updatePerformanceChart() {
            const chartContainer = document.getElementById('performanceChart');
            chartContainer.innerHTML = '';
            
            const subjects = [...new Set(grades.map(grade => grade.subject))];
            const subjectAverages = {};
            
            subjects.forEach(subject => {
                const subjectGrades = grades.filter(grade => grade.subject === subject);
                const sum = subjectGrades.reduce((acc, grade) => acc + grade.grade, 0);
                subjectAverages[subject] = sum / subjectGrades.length;
            });
            
            const maxGrade = 10;
            const chartHeight = 160;
            
            subjects.forEach(subject => {
                const average = subjectAverages[subject];
                const barHeight = (average / maxGrade) * chartHeight;
                
                const barContainer = document.createElement('div');
                barContainer.className = 'flex flex-col items-center mx-1';
                
                const bar = document.createElement('div');
                bar.className = `w-8 rounded-t-lg ${average >= 8 ? 'bg-green-500' : average >= 5 ? 'bg-blue-500' : 'bg-red-500'}`;
                bar.style.height = `${barHeight}px`;
                
                const label = document.createElement('span');
                label.className = 'text-xs mt-1 text-gray-600';
                label.textContent = subject.substring(0, 3);
                label.title = subject;
                
                const gradeLabel = document.createElement('span');
                gradeLabel.className = 'text-xs font-medium mt-1';
                gradeLabel.textContent = average.toFixed(1);
                
                barContainer.appendChild(bar);
                barContainer.appendChild(gradeLabel);
                barContainer.appendChild(label);
                
                chartContainer.appendChild(barContainer);
            });
        }
        
        // Manejar el envío del formulario
        function handleSubmit(e) {
            e.preventDefault();
            
            // Validación adicional
            if (!subjectInput.value || !gradeInput.value || !dateInput.value) {
                alert('Por favor complete todos los campos obligatorios');
                return;
            }
            
            const gradeValue = parseFloat(gradeInput.value);
            if (gradeValue < 0 || gradeValue > 10) {
                alert('La calificación debe estar entre 0 y 10');
                return;
            }
            
            const newGrade = {
                id: Date.now().toString(),
                subject: subjectInput.value,
                grade: gradeValue,
                date: dateInput.value,
                notes: notesInput.value
            };
            
            grades.push(newGrade);
            saveGrades();
            renderGrades();
            updateStats();
            
            // Limpiar el formulario
            gradeForm.reset();
            dateInput.value = new Date().toISOString().split('T')[0];
        }
        
        // Manejar la edición de una calificación
        function handleEdit(e) {
            const row = e.target.closest('tr');
            const id = row.dataset.id;
            const grade = grades.find(grade => grade.id === id);
            
            if (grade) {
                editId.value = grade.id;
                editSubject.value = grade.subject;
                editGrade.value = grade.grade;
                editDate.value = grade.date;
                editNotes.value = grade.notes || '';
                
                editModal.classList.remove('hidden');
            }
        }
        
        // Manejar la eliminación de una calificación
        function handleDelete(e) {
            if (confirm('¿Estás seguro de que deseas eliminar esta calificación?')) {
                const row = e.target.closest('tr');
                const id = row.dataset.id;
                
                grades = grades.filter(grade => grade.id !== id);
                saveGrades();
                renderGrades();
                updateStats();
            }
        }
        
        // Manejar el cierre del modal
        function handleCloseModal() {
            editModal.classList.add('hidden');
        }
        
        // Manejar la cancelación de la edición
        function handleCancelEdit() {
            handleCloseModal();
        }
        
        // Manejar el guardado de los cambios
        function handleEditSubmit(e) {
            e.preventDefault();
            
            const id = editId.value;
            const index = grades.findIndex(grade => grade.id === id);
            
            if (index !== -1) {
                grades[index] = {
                    id,
                    subject: editSubject.value,
                    grade: parseFloat(editGrade.value),
                    date: editDate.value,
                    notes: editNotes.value
                };
                
                saveGrades();
                renderGrades();
                updateStats();
                handleCloseModal();
            }
        }
        
        // Limpiar todos los registros
        function handleClearAll() {
            if (grades.length === 0) return;
            
            if (confirm('¿Estás seguro de que deseas eliminar TODAS las calificaciones? Esta acción no se puede deshacer.')) {
                grades = [];
                saveGrades();
                renderGrades();
                updateStats();
            }
        }
        
        // Guardar calificaciones en localStorage
        function saveGrades() {
            localStorage.setItem('grades', JSON.stringify(grades));
        }
        
        // Event listeners
        gradeForm.addEventListener('submit', handleSubmit);
        editForm.addEventListener('submit', handleEditSubmit);
        closeModalBtn.addEventListener('click', handleCloseModal);
        cancelEditBtn.addEventListener('click', handleCancelEdit);
        clearAllBtn.addEventListener('click', handleClearAll);
        
        // Inicializar
        init();
    </script>
</body>
</html>